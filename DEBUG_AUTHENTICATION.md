# Debugging World App Authentication Issues

This guide helps debug authentication failures when the wallet signing works in World App but web verification fails.

## Current Status

✅ **Backend SIWE Infrastructure**: Complete and tested
✅ **Frontend Integration**: Complete with detailed logging
✅ **Mock Authentication**: Working perfectly in development
❌ **Real World App Authentication**: Failing at verification step

## Debugging Steps

### 1. Enable Development Logging

The application now includes comprehensive logging. When testing in World App:

1. Open the World App
2. Navigate to your mini-app
3. Open browser developer tools (if available)
4. Click "Connect Wallet"
5. Check both browser console and server logs

### 2. Key Logging Points

**Frontend Logs (Browser Console):**
- `Auth result details:` - Shows what World App returns
- `SIWE message from World App:` - Shows the exact SIWE message format
- `Backend verification failed:` - Shows verification errors

**Backend Logs (Server Console):**
- `Received SIWE message:` - Shows the message received by backend
- `Parsed SIWE message:` - Shows how the message was parsed
- `Signature verification failed:` - Shows signature validation errors
- `SIWE validation failed:` - Shows SIWE format validation errors

### 3. Common Issues and Solutions

#### Issue 1: SIWE Message Format Mismatch
**Symptoms:** "Invalid SIWE message format" error
**Solution:** Compare the SIWE message from World App with expected EIP-4361 format

#### Issue 2: Signature Format Issues
**Symptoms:** "Invalid signature format" error
**Solution:** Check if signature is properly hex-encoded and has correct length

#### Issue 3: Nonce Mismatch
**Symptoms:** Verification fails silently
**Solution:** Ensure the nonce in SIWE message matches the one generated by backend

#### Issue 4: Domain/URI Mismatch
**Symptoms:** SIWE validation fails
**Solution:** Check if domain and URI in SIWE message match your app's configuration

### 4. Testing in Development

To test the authentication flow in development:

```bash
# Start the development server
npm run dev

# Open http://localhost:3000
# Click "Connect Wallet"
# Check console for detailed logs
```

The mock authentication will show you exactly what format is expected.

### 5. Comparing Mock vs Real Data

**Mock SIWE Message Format:**
```
localhost:3000 wants you to sign in with your Ethereum account:
0x1234567890123456789012345678901234567890

Sign in to JackpotWLD to access your account

URI: http://localhost:3000
Version: 1
Chain ID: 480
Nonce: [generated-nonce]
Issued At: [timestamp]
Expiration Time: [timestamp]
```

**Expected from World App:**
Should follow the same EIP-4361 format but with:
- Correct domain (your app's domain)
- Real user address
- Real signature from World App

### 6. Next Steps for Debugging

1. **Capture Real Data**: Test in World App and capture the exact logs
2. **Compare Formats**: Compare World App SIWE message with mock format
3. **Check Signature**: Verify signature format and encoding
4. **Validate Parsing**: Ensure backend correctly parses World App's SIWE message

### 7. Potential Fixes

Based on the logs, you may need to:

- Adjust SIWE message parsing logic
- Handle different signature formats
- Update domain/URI validation
- Fix nonce handling

## Contact

If you need help interpreting the logs or implementing fixes, provide:
1. Browser console logs (Auth result details)
2. Server console logs (Received SIWE message)
3. Any error messages from verification